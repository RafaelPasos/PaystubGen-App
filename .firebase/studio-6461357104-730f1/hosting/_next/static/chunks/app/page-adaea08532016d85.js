(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{25684:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eb});var r=a(95155),s=a(12115),n=a(35317),o=a(96454),i=a(34548),l=a(5227),d=a(7860),c=a(3310),m=a(40610),u=a(52955);let p=(0,s.createContext)(void 0),f=[{name:"Corazones Salitre"},{name:"Corazones agua caliente"},{name:"Hojas Salitre"},{name:"Hojas Estanzuela"}],h={Corazones:[{name:"Chico",payRate:10},{name:"Mediano",payRate:12},{name:"Grande",payRate:14},{name:"Mini",payRate:10}],Hojas:[{name:"Blanca",payRate:13},{name:"Capote",payRate:8},{name:"Tira",payRate:6}]},x=(e,t)=>{let a=new m.$({operation:"list",path:t});c.d.emit("permission-error",a)},g=e=>{let{children:t}=e,a=(0,o.jt)(),[g,y]=(0,s.useState)([]),[b,w]=(0,s.useState)([]),[v,j]=(0,s.useState)([]),[N,C]=(0,s.useState)([]),[E,I]=(0,s.useState)(!0),[k,D]=(0,s.useState)({}),[S,R]=(0,s.useState)({}),[P,z]=(0,s.useState)(!1),A=(0,s.useCallback)(()=>{let e={};for(let t in S)e[t]={...S[t],quantity:0};R(e),z(!0)},[S]),_=async()=>{if(!a)return;let e=(0,n.wP)(a);Object.entries(k).forEach(t=>{let[r,s]=t,o=v.find(e=>e.id===r);if(o&&o.payRate!==s){let t=(0,n.H9)(a,"teams/".concat(o.teamId,"/productionItems"),r);e.update(t,{payRate:s})}}),Object.values(S).forEach(t=>{let r=N.find(e=>e.id===t.id),s=b.find(e=>e.id===t.employeeId);if(s){if(r){if(r.quantity!==t.quantity){let r=(0,n.H9)(a,"teams/".concat(s.teamId,"/employees/").concat(t.employeeId,"/dailyProduction"),t.id);e.update(r,{quantity:t.quantity})}}else if(t.quantity>0){let{id:r,...o}=t,i=(0,n.H9)((0,n.rJ)(a,"teams/".concat(s.teamId,"/employees/").concat(t.employeeId,"/dailyProduction")));e.set(i,o)}}});try{await e.commit(),z(!1)}catch(e){throw c.d.emit("permission-error",new m.$({operation:"write",path:"batch update",requestResourceData:"Batch update of rates and production"})),e}};(0,s.useEffect)(()=>{let e={};v.forEach(t=>{e[t.id]=t.payRate}),D(e);let t={};N.forEach(e=>{t[e.id]={...e}});let a=(0,i.k)(new Date,{weekStartsOn:1}),r=(0,d.k)({start:a,end:new Date(a.getTime()+432e6)});b.forEach(e=>{v.filter(t=>t.teamId===e.teamId).forEach(a=>{r.forEach(r=>{let s=(0,l.x)(r,{representation:"date"});if(!Object.values(t).some(t=>t.employeeId===e.id&&t.productionItemId===a.id&&t.date===s)){let r="placeholder-".concat(e.id,"-").concat(a.id,"-").concat(s);t[r]={id:r,employeeId:e.id,productionItemId:a.id,date:s,quantity:0}}})})}),R(t),z(!1)},[v,N,b]);let J=(0,s.useCallback)(async(e,t,r)=>{if(!a)return;if(0===r.length)return void console.warn("No production items found for team ".concat(t,". Cannot create initial entries."));let s=(0,n.wP)(a),o=(0,i.k)(new Date,{weekStartsOn:1}),u=new Date(o);u.setDate(u.getDate()+5);let p=(0,d.k)({start:o,end:u}),f=[];for(let o of r)for(let r of p){let i=(0,l.x)(r,{representation:"date"}),d={employeeId:e,productionItemId:o.id,date:i,quantity:0},c=(0,n.H9)((0,n.rJ)(a,"teams/".concat(t,"/employees/").concat(e,"/dailyProduction")));s.set(c,d),f.push({...d,id:c.id})}try{await s.commit()}catch(a){throw c.d.emit("permission-error",new m.$({operation:"write",path:"teams/".concat(t,"/employees/").concat(e,"/dailyProduction"),requestResourceData:"Batched initial production entries"})),a}},[a]);(0,s.useEffect)(()=>{if(!a)return;I(!0);let e=(0,n.P)((0,n.rJ)(a,"teams")),t=(0,n.aQ)(e,async e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));if(e.empty){let e=await (0,u.dC)((0,n.rJ)(a,"teams"));if(e.empty){let e=(0,n.wP)(a),r=[];for(let t of f){let s=(0,n.H9)((0,n.rJ)(a,"teams"));e.set(s,t),r.push({id:s.id,...t});let o=h[t.name.includes("Corazones")?"Corazones":"Hojas"],i=(0,n.rJ)(a,"teams/".concat(s.id,"/productionItems"));o.forEach(t=>{let a=(0,n.H9)(i);e.set(a,{...t,teamId:s.id})})}await e.commit().catch(e=>{c.d.emit("permission-error",new m.$({operation:"write",path:"teams",requestResourceData:"Initial teams and items batch write"}))}),t=r}else t=e.docs.map(e=>({id:e.id,...e.data()}))}y(t);let r=(0,n.wP)(a),s=!1;for(let e of t)if((await (0,n.Rr)((0,n.rJ)(a,"teams/".concat(e.id,"/productionItems")))).empty){s=!0;let t=h[e.name.includes("Corazones")?"Corazones":"Hojas"],o=(0,n.rJ)(a,"teams/".concat(e.id,"/productionItems"));t.forEach(t=>{let a=(0,n.H9)(o);r.set(a,{...t,teamId:e.id})})}s?await r.commit().catch(e=>{c.d.emit("permission-error",new m.$({operation:"write",path:"productionItems",requestResourceData:"Default items for new team batch write"}))}):I(!1)},e=>{x(e,"teams"),I(!1)});return()=>{t()}},[a]),(0,s.useEffect)(()=>{if(!a||0===g.length){w([]),j([]),C([]);return}let e=[];I(!0);let t=[],r=[],s=[],o=0;return g.forEach(i=>{let l=(0,n.P)((0,n.rJ)(a,"teams/".concat(i.id,"/productionItems"))),d=(0,n.aQ)(l,e=>{let a=e.docs.map(e=>({id:e.id,...e.data()})),r=t.filter(e=>e.teamId!==i.id);t.splice(0,t.length,...r,...a),j(Array.from(new Map(t.map(e=>[e.id,e])).values()))},e=>x(e,"teams/".concat(i.id,"/productionItems")));e.push(d);let c=(0,n.P)((0,n.rJ)(a,"teams/".concat(i.id,"/employees"))),m=(0,n.aQ)(c,t=>{let l=t.docs.map(e=>({id:e.id,...e.data()})),d=r.filter(e=>e.teamId!==i.id);r.splice(0,r.length,...d,...l),w(Array.from(new Map(r.map(e=>[e.id,e])).values())),t.docChanges().forEach(t=>{if("added"===t.type){let r=t.doc.id,o=(0,n.P)((0,n.rJ)(a,"teams/".concat(i.id,"/employees/").concat(r,"/dailyProduction"))),l=(0,n.aQ)(o,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()})),a=s.filter(e=>e.employeeId!==r);s.splice(0,s.length,...a,...t),C(Array.from(new Map(s.map(e=>[e.id,e])).values()))},e=>x(e,"teams/".concat(i.id,"/employees/").concat(r,"/dailyProduction")));e.push(l)}if("removed"===t.type){let e=t.doc.id;s.splice(0,s.length,...s.filter(t=>t.employeeId!==e)),C(Array.from(new Map(s.map(e=>[e.id,e])).values()))}}),++o>=g.length&&I(!1)},e=>x(e,"teams/".concat(i.id,"/employees")));e.push(m)}),()=>e.forEach(e=>e())},[a,g]);let O=async e=>{if(!a)return;let t=(0,n.rJ)(a,"teams");try{await (0,n.gS)(t,e).catch(a=>{throw c.d.emit("permission-error",new m.$({operation:"create",path:t.path,requestResourceData:e})),a})}catch(e){throw e instanceof m.$||console.error("Error adding team:",e),e}},G=async e=>{if(!a)return;let t=(0,n.H9)(a,"teams",e);try{let r=(0,n.wP)(a),s=(0,n.rJ)(a,"teams/".concat(e,"/productionItems"));(await (0,n.GG)(s).catch(e=>{throw e})).forEach(e=>r.delete(e.ref));let o=(0,n.rJ)(a,"teams/".concat(e,"/employees"));for(let t of(await (0,n.GG)(o).catch(e=>{throw e})).docs){let s=(0,n.rJ)(a,"teams/".concat(e,"/employees/").concat(t.id,"/dailyProduction"));(await (0,n.GG)(s).catch(e=>{throw e})).forEach(e=>r.delete(e.ref)),r.delete(t.ref)}r.delete(t),await r.commit()}catch(t){throw c.d.emit("permission-error",new m.$({operation:"delete",path:"teams/".concat(e," and its subcollections")})),t instanceof m.$||console.error("Error deleting team and its data:",t),t}},F=async e=>{if(!a)return;let t=(0,n.rJ)(a,"teams/".concat(e.teamId,"/employees"));try{let a=v.filter(t=>t.teamId===e.teamId),r=await (0,n.gS)(t,e).catch(a=>{throw c.d.emit("permission-error",new m.$({operation:"create",path:t.path,requestResourceData:e})),a});await J(r.id,e.teamId,a)}catch(e){e instanceof m.$||console.error("Error adding employee:",e)}},q=async(e,t)=>{if(!a)return;let r=(0,n.H9)(a,"teams/".concat(t,"/employees"),e);try{let s=(0,n.P)((0,n.rJ)(r,"dailyProduction")),o=await (0,n.GG)(s).catch(a=>{throw x(a,"teams/".concat(t,"/employees/").concat(e,"/dailyProduction")),a}),i=(0,n.wP)(a);o.forEach(e=>i.delete(e.ref)),await i.commit(),await (0,n.kd)(r).catch(e=>{throw c.d.emit("permission-error",new m.$({path:r.path,operation:"delete"})),e})}catch(e){e instanceof m.$||console.error("Error deleting employee and their production:",e)}};return(0,r.jsx)(p.Provider,{value:{teams:g,employees:b,items:v,production:N,loading:E,addEmployee:F,deleteEmployee:q,addTeam:O,deleteTeam:G,localRates:k,localProduction:S,hasChanges:P,handleRateChange:(e,t)=>{D(a=>({...a,[e]:parseFloat(t)||0})),z(!0)},handleProductionChange:(e,t,a,r)=>{let s=parseInt(r,10),n=isNaN(s)?0:s,o=new Date((0,i.k)(new Date,{weekStartsOn:1}));o.setDate(o.getDate()+a);let d=(0,l.x)(o,{representation:"date"}),c=Object.values(S).find(a=>a.employeeId===e&&a.productionItemId===t&&a.date===d);if(c)R(e=>({...e,[c.id]:{...c,quantity:""===r?0:n}}));else{let a="new-".concat(e,"-").concat(t,"-").concat(d),r={id:a,employeeId:e,productionItemId:t,date:d,quantity:n};R(e=>({...e,[a]:r}))}z(!0)},saveAllChanges:_,resetProduction:A},children:t})},y=()=>{let e=(0,s.useContext)(p);if(void 0===e)throw Error("useData must be used within a DataProvider");return e};var b=a(66634),w=a(74466),v=a(59434);let j=(0,w.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),N=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:o=!1,...i}=e,l=o?b.DX:"button";return(0,r.jsx)(l,{className:(0,v.cn)(j({variant:s,size:n,className:a})),ref:t,...i})});N.displayName="Button";var C=a(34301),E=a(17104);function I(e){let{isAuthenticated:t,onLoginClick:a,onAddTeamClick:s}=e;return(0,r.jsx)("header",{className:"bg-white shadow-md",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center",children:[(0,r.jsx)("div",{className:"w-1/4"}),(0,r.jsx)("h1",{className:"text-4xl font-bold text-center text-gray-900 w-1/2",children:"GENERADOR DE RECIBOS DE PAGO"}),(0,r.jsx)("div",{className:"w-1/4 flex justify-end",children:t?(0,r.jsxs)(N,{onClick:s,variant:"outline",className:"flex items-center gap-2",children:[(0,r.jsx)(C.A,{size:18}),(0,r.jsx)("span",{children:"Agregar Grupo"})]}):(0,r.jsxs)(N,{onClick:a,variant:"outline",className:"flex items-center gap-2",children:[(0,r.jsx)(E.A,{size:18}),(0,r.jsx)("span",{children:"Entrar"})]})})]})})}var k=a(18880);let D=k.bL,S=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(k.B8,{ref:t,className:(0,v.cn)("inline-flex items-center justify-center rounded-none bg-transparent p-0 border-b border-gray-200",a),...s})});S.displayName=k.B8.displayName;let R=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(k.l9,{ref:t,className:(0,v.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-none px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-sm border-b-4 border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-300",a),...s})});R.displayName=k.l9.displayName;let P=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(k.UC,{ref:t,className:(0,v.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s})});P.displayName=k.UC.displayName;let z=s.forwardRef((e,t)=>{let{className:a,type:s,...n}=e;return(0,r.jsx)("input",{type:s,className:(0,v.cn)("flex h-auto w-full rounded-lg border border-gray-300 bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 shadow-sm md:text-sm",a),ref:t,...n})});z.displayName="Input";var A=a(62278);let _=A.bL,J=A.l9,O=A.ZL,G=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(A.hJ,{className:(0,v.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t})});G.displayName=A.hJ.displayName;let F=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsxs)(O,{children:[(0,r.jsx)(G,{}),(0,r.jsx)(A.UC,{ref:t,className:(0,v.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]})});F.displayName=A.UC.displayName;let q=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,v.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};q.displayName="AlertDialogHeader";let H=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,v.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};H.displayName="AlertDialogFooter";let $=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(A.hE,{ref:t,className:(0,v.cn)("text-lg font-semibold",a),...s})});$.displayName=A.hE.displayName;let T=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(A.VY,{ref:t,className:(0,v.cn)("text-sm text-muted-foreground",a),...s})});T.displayName=A.VY.displayName;let L=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(A.rc,{ref:t,className:(0,v.cn)(j(),a),...s})});L.displayName=A.rc.displayName;let M=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(A.ZD,{ref:t,className:(0,v.cn)(j({variant:"outline"}),"mt-2 sm:mt-0",a),...s})});M.displayName=A.ZD.displayName;var B=a(77223);function U(e){let{team:t,isAuthenticated:a,onDeleteTeam:n}=e,{employees:o,items:d,localProduction:c,localRates:m,addEmployee:u,deleteEmployee:p,handleRateChange:f,handleProductionChange:h}=y(),[x,g]=(0,s.useState)(""),b=o.filter(e=>e.teamId===t.id),w=d.filter(e=>e.teamId===t.id),v=async()=>{x.trim()&&(await u({name:x,teamId:t.id}),g(""))},j=["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado"];return(0,r.jsxs)("div",{children:[a&&(0,r.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-lg mb-8",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b pb-3",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold",children:t.name}),(0,r.jsxs)(_,{children:[(0,r.jsx)(J,{asChild:!0,children:(0,r.jsxs)(N,{variant:"destructive",className:"flex items-center gap-2",children:[(0,r.jsx)(B.A,{size:16}),"Quitar Grupo"]})}),(0,r.jsxs)(F,{children:[(0,r.jsxs)(q,{children:[(0,r.jsxs)($,{children:['Estas seguro de eliminar "',t.name,'"?']}),(0,r.jsx)(T,{children:"Esta accion no se puede cancelar. Esto eliminar\xe1 permanentemente el grupo y todos sus datos asociados, incluyendo empleados y registros de producci\xf3n."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(M,{children:"Cancelar"}),(0,r.jsx)(L,{onClick:()=>n(t.id),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar Permanentemente"})]})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"md:col-span-3",children:[(0,r.jsx)("label",{htmlFor:"employeeName-".concat(t.id),className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del nuevo empleado"}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)(z,{id:"employeeName-".concat(t.id),value:x,onChange:e=>g(e.target.value),placeholder:"Agregar al grupo de ".concat(t.name.toLowerCase()),className:"flex-grow w-full p-3",onKeyDown:e=>"Enter"===e.key&&v()}),(0,r.jsx)(N,{onClick:v,className:"bg-blue-600 text-white font-semibold px-6 py-3 h-auto rounded-lg shadow-md hover:bg-blue-700",children:"Agregar"})]})]}),(0,r.jsxs)("div",{className:"md:col-span-3 mt-4 pt-4 border-t",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t.name.includes("Corazones")?"Pago x pieza":"Pago por kg"}),(0,r.jsx)("div",{className:"grid grid-cols-2 ".concat(t.name.includes("Corazones")?"sm:grid-cols-4":"sm:grid-cols-3"," gap-4"),children:w.map(e=>{var t;return(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:e.name}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500",children:"$"}),(0,r.jsx)(z,{type:"number",min:"0",step:"1",value:null!=(t=m[e.id])?t:"",onChange:t=>f(e.id,t.currentTarget.value),className:"w-full pl-7 p-3",disabled:!a})]})]},e.id)})})]})]})]}),(0,r.jsx)("div",{className:"space-y-8",children:b.length>0?b.map(e=>(0,r.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-lg",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4 border-b pb-4",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:e.name}),a&&(0,r.jsxs)(_,{children:[(0,r.jsx)(J,{asChild:!0,children:(0,r.jsx)(N,{variant:"ghost",className:"text-red-500 hover:text-red-700 font-semibold py-2 px-4 rounded-lg hover:bg-red-100 transition",children:"Eliminar"})}),(0,r.jsxs)(F,{children:[(0,r.jsxs)(q,{children:[(0,r.jsx)($,{children:"Estas seguro?"}),(0,r.jsxs)(T,{children:["Esta accion no se puede cancelar, esta seguro de eliminar a ",e.name,"?"]})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(M,{children:"Cancel"}),(0,r.jsx)(L,{onClick:()=>p(e.id,t.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-2 text-gray-600",children:"Producci\xf3n Semanal"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-center",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b-2",children:[(0,r.jsx)("th",{className:"py-2 px-3 text-left font-medium text-gray-500 text-sm",children:"Tipo"}),j.map(e=>(0,r.jsx)("th",{className:"py-2 px-1 font-medium text-gray-500 text-sm",children:e.substring(0,3)},e))]})}),(0,r.jsx)("tbody",{children:w.map(t=>(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("td",{className:"font-semibold py-2 px-3 text-gray-700",children:t.name}),j.map((a,s)=>{let n=new Date((0,i.k)(new Date,{weekStartsOn:1}));n.setDate(n.getDate()+s);let o=(0,l.x)(n,{representation:"date"}),d=Object.values(c).find(a=>a.employeeId===e.id&&a.productionItemId===t.id&&a.date===o),m=null==d?void 0:d.quantity;return(0,r.jsx)("td",{className:"p-1",children:(0,r.jsx)(z,{type:"text",value:0===m?"":null!=m?m:"",onChange:a=>h(e.id,t.id,s,a.currentTarget.value),className:"w-20 p-2"})},s)})]},t.id))})]})})]})]},e.id)):(0,r.jsx)("div",{className:"text-center py-12 bg-white rounded-2xl shadow-lg",children:(0,r.jsx)("h3",{className:"text-xl font-medium text-gray-500",children:"No hay personal registrado"})})})]})}var V=a(41297),Y=a(51920),Q=a(965),Z=a(73158),K=a(43900);function X(e){let{className:t,classNames:a,showOutsideDays:s=!0,...n}=e;return(0,r.jsx)(K.hv,{showOutsideDays:s,className:(0,v.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,v.cn)(j({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,v.cn)(j({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,r.jsx)(Q.A,{className:(0,v.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,r.jsx)(Z.A,{className:(0,v.cn)("h-4 w-4",t),...a})}},...n})}X.displayName="Calendar";var W=a(46277);let ee=W.bL,et=W.l9,ea=s.forwardRef((e,t)=>{let{className:a,align:s="center",sideOffset:n=4,...o}=e;return(0,r.jsx)(W.ZL,{children:(0,r.jsx)(W.UC,{ref:t,align:s,sideOffset:n,className:(0,v.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})})});function er(e){let{date:t,setDate:a,className:s}=e;return(0,r.jsxs)(ee,{children:[(0,r.jsx)(et,{asChild:!0,children:(0,r.jsxs)(N,{variant:"outline",className:(0,v.cn)("w-full justify-start text-left font-normal p-3 h-auto border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500",!t&&"text-muted-foreground",s),children:[(0,r.jsx)(Y.A,{className:"mr-2 h-4 w-4"}),t?(0,V.GP)(t,"PPP"):(0,r.jsx)("span",{children:"Pick a date"})]})}),(0,r.jsx)(ea,{className:"w-auto p-0",children:(0,r.jsx)(X,{mode:"single",selected:t,onSelect:a,initialFocus:!0})})]})}ea.displayName=W.UC.displayName;var es=a(26597);a(86087);var en=a(87481),eo=a(50172);function ei(){return(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-background",children:(0,r.jsx)(eo.A,{className:"h-16 w-16 animate-spin text-primary"})})}var el=a(45821),ed=a(25318);let ec=el.bL;el.l9;let em=el.ZL;el.bm;let eu=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(el.hJ,{ref:t,className:(0,v.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});eu.displayName=el.hJ.displayName;let ep=s.forwardRef((e,t)=>{let{className:a,children:s,hideCloseButton:n,...o}=e;return(0,r.jsxs)(em,{children:[(0,r.jsx)(eu,{}),(0,r.jsxs)(el.UC,{ref:t,className:(0,v.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[s,!n&&(0,r.jsxs)(el.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(ed.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});ep.displayName=el.UC.displayName;let ef=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,v.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};ef.displayName="DialogHeader";let eh=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,v.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};eh.displayName="DialogFooter";let ex=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(el.hE,{ref:t,className:(0,v.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});ex.displayName=el.hE.displayName;let eg=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(el.VY,{ref:t,className:(0,v.cn)("text-sm text-muted-foreground",a),...s})});function ey(){let[e,t]=(0,s.useState)(new Date),{teams:a,employees:n,items:o,production:d,loading:c,hasChanges:m,saveAllChanges:u,resetProduction:p,addTeam:f,deleteTeam:h}=y(),{toast:x}=(0,en.dj)(),[g,b]=(0,s.useState)(!1),[w,v]=(0,s.useState)(""),[j,C]=(0,s.useState)(!1),[E,k]=(0,s.useState)(""),[A,_]=(0,s.useState)(!1),[J,O]=(0,s.useState)("");(0,s.useEffect)(()=>{if(a.length>0){let e=a.some(e=>e.name===w);w&&e||v("Corazones Salitre")}else 0!==a.length||c||v("")},[a,w,c]);let G=()=>{"password"===E?(b(!0),C(!1),k(""),x({title:"Exito",description:"Contrase\xf1a correcta"})):x({title:"Error",description:"Contrase\xf1a incorrecta",variant:"destructive"})},F=async()=>{try{await u(),x({title:"Exito",description:"Cambios guardados."})}catch(e){x({title:"Error",description:"No se pudieron guardar los cambios.",variant:"destructive"})}},q=async()=>{if(J.trim())try{await f({name:J.trim()}),x({title:"Exito",description:"Grupo '".concat(J.trim(),"' agregado.")}),O(""),_(!1)}catch(e){x({title:"Error",description:"No se pudo agregar el grupo.",variant:"destructive"})}},H=async e=>{try{await h(e),x({title:"Exito",description:"Grupo eliminado."})}catch(e){x({title:"Error",description:"No se pudo eliminar el grupo.",variant:"destructive"})}};return c?(0,r.jsx)(ei,{}):(0,r.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-100 text-gray-800",children:[(0,r.jsx)(I,{isAuthenticated:g,onLoginClick:()=>C(!0),onAddTeamClick:()=>_(!0)}),(0,r.jsxs)("main",{className:"flex-1 max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 w-full",children:[(0,r.jsx)(ec,{open:j,onOpenChange:C,children:(0,r.jsxs)(ep,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(ef,{children:[(0,r.jsx)(ex,{children:"Contrase\xf1a"}),(0,r.jsx)(eg,{children:"Ingrese contrase\xf1a para acceder e imprimir recibos."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsx)(z,{id:"password",type:"password",value:E,onChange:e=>k(e.target.value),placeholder:"Ingrese contrase\xf1a",className:"w-full p-3",onKeyDown:e=>"Enter"===e.key&&G()})}),(0,r.jsx)(eh,{children:(0,r.jsx)(N,{onClick:G,className:"w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-blue-700 text-lg h-auto",children:"Entrar"})})]})}),(0,r.jsx)(ec,{open:A,onOpenChange:_,children:(0,r.jsxs)(ep,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(ef,{children:[(0,r.jsx)(ex,{children:"Agregar Nuevo Grupo"}),(0,r.jsx)(eg,{children:"Ingrese el nombre del nuevo grupo. Se le asignar\xe1n los art\xedculos de producci\xf3n por defecto."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsx)(z,{id:"newTeamName",type:"text",value:J,onChange:e=>O(e.target.value),placeholder:"Nombre del grupo",className:"w-full p-3",onKeyDown:e=>"Enter"===e.key&&q()})}),(0,r.jsx)(eh,{children:(0,r.jsx)(N,{onClick:q,className:"w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-blue-700 text-lg h-auto",children:"Agregar Grupo"})})]})}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-lg mb-8",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-center",children:"Fecha de pago"}),(0,r.jsx)("div",{className:"max-w-xs mx-auto",children:(0,r.jsx)(er,{date:e,setDate:t})})]}),a.length>0?(0,r.jsxs)(D,{value:w,onValueChange:v,className:"w-full",children:[(0,r.jsx)(S,{className:"grid w-full grid-cols-2 md:grid-cols-4 h-auto mb-8",children:a.map(e=>(0,r.jsx)(R,{value:e.name,className:"text-sm md:text-base font-semibold py-3 px-2 md:px-4 transition-colors duration-300 data-[state=active]:border-blue-500 data-[state=active]:bg-blue-500 data-[state=active]:text-white",children:e.name},e.id))}),a.map(e=>(0,r.jsx)(P,{value:e.name,children:(0,r.jsx)(U,{team:e,isAuthenticated:g,onDeleteTeam:H})},e.id))]}):(0,r.jsx)("div",{className:"text-center py-12 bg-white rounded-2xl shadow-lg",children:(0,r.jsx)("h3",{className:"text-xl font-medium text-gray-500",children:"No hay grupos. Agrega un grupo para empezar."})}),(0,r.jsxs)("footer",{className:"mt-12 text-center flex justify-center items-center gap-4",children:[(0,r.jsx)(N,{onClick:p,variant:"outline",className:"bg-white text-gray-700 font-bold px-10 py-4 rounded-lg shadow-xl hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-transform transform hover:scale-105 text-lg h-auto",children:"REINICIAR"}),m&&(0,r.jsx)(N,{onClick:F,className:"bg-yellow-500 text-white font-bold px-10 py-4 rounded-lg shadow-xl hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-transform transform hover:scale-105 text-lg h-auto",children:"GUARDAR CAMBIOS"}),g&&(0,r.jsx)(N,{onClick:()=>{if(!g)return void C(!0);if(m)return void x({title:"Cambios sin guardar",description:"Por favor guarde sus cambios antes de generar el PDF.",variant:"destructive"});if(!e)return void x({title:"Error",description:"Por favor selecione una fecha",variant:"destructive"});if(0===n.length)return void x({title:"Error",description:"Agrega al menos un empleado para crear el reporte",variant:"destructive"});let t=new es.jsPDF,r=new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0],s=15,c=t.internal.pageSize.getHeight(),u=["Lunes","Martes","Miercoles","Jueves","Viernes","S\xe1bado"];a.forEach(e=>{let a=n.filter(t=>t.teamId===e.id),m=o.filter(t=>t.teamId===e.id);a.forEach(a=>{let n=35+6*m.length;s+n>c-20&&(t.addPage(),s=15),t.setFontSize(16),t.setFont("helvetica","bold"),t.text("Recibo de pago",14,s),t.setFontSize(10),t.setFont("helvetica","normal"),t.text("Grupo: ".concat(e.name),200,s,{align:"right"}),s+=7,t.setFontSize(12),t.text("".concat(a.name),14,s),t.text("Fecha: ".concat(r),200,s,{align:"right"}),s+=2;let o=d.filter(e=>e.employeeId===a.id),p=0,f=(0,i.k)(new Date,{weekStartsOn:1}),h=m.map(e=>{let t=o.filter(t=>t.productionItemId===e.id),a=u.map((e,a)=>{let r=new Date(f);r.setDate(r.getDate()+a);let s=(0,l.x)(r,{representation:"date"}),n=t.find(e=>e.date===s);return n?n.quantity:0}),r=a.reduce((e,t)=>e+t,0),s=e.payRate,n=r*s;return p+=n,[e.name,...a,r,"$".concat(s.toFixed(2)),"$".concat(n.toFixed(2))]});t.autoTable({head:[["Tipo",...u,"Cantidad",e.name.includes("Corazones")?"Pago x pza":"Pago x kg","Subtotal"]],body:h,startY:s,theme:"grid",headStyles:{fillColor:[41,128,185],textColor:255},styles:{fontSize:8,cellPadding:1.5},columnStyles:{0:{fontStyle:"bold"},7:{halign:"right"},8:{halign:"right"},9:{halign:"right",fontStyle:"bold"}}}),s=t.lastAutoTable.finalY,t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Pago Total de la Semana: $".concat(p.toFixed(2)),14,s+12),s+=25})}),t.save("recibos_".concat(r.replace(/-/g,"_"),".pdf"))},className:"bg-green-600 text-white font-bold px-10 py-4 rounded-lg shadow-xl hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform transform hover:scale-105 text-lg h-auto",children:"GENERAR RECIBOS"})]})]})]})}function eb(){return(0,r.jsx)(g,{children:(0,r.jsx)(ey,{})})}eg.displayName=el.VY.displayName},32751:(e,t,a)=>{Promise.resolve().then(a.bind(a,25684))}},e=>{var t=t=>e(e.s=t);e.O(0,[992,644,930,370,124,794,441,684,358],()=>t(32751)),_N_E=e.O()}]);